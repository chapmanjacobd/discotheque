  3. Structured Logging (slog)
  main.go currently uses a mix of fmt.Printf and fmt.Fprintf(os.Stderr, ...).
   * Implementation: Switch to Go 1.21's log/slog. This allows for different verbosity levels (--verbose) and JSON-formatted logs for automated environments.


  4. Logic Extraction & Modularization
  main.go is growing large (~1400 lines).
   * Implementation: Move command implementations (e.g., StatsCmd.Run, WatchCmd.Run) into internal/commands. Move the QueryBuilder and MediaQuery logic into internal/query.
   * Benefit: Better testability and easier for other Go programs to use discotheque as a library.

  5. Advanced Media Type Detection
  Currently, we rely mostly on file extensions.
   * Implementation: Use ffprobe's stream data or a mimetype library to more accurately distinguish between "Video", "Audio (music)", "Audiobook (long audio)", and "Image".


  6. External Tool Integration (fzf)
  The Python version supports selecting media via fzf.
   * Implementation: Add a --picker or --fzf flag that pipes the filtered media list into fzf and plays only the selected items.


  7. Database Optimization
   * Implementation: Add an optimize command that runs VACUUM, ANALYZE, and ensures FTS indexes are fully populated.

# Run all tests
go test ./... -v

# Run specific test package
go test ./internal/filter -v
go test ./internal/sort -v
go test ./internal/aggregate -v
go test ./internal/history -v

# Run tests with coverage
go test ./... -cover

# Build
go build -o lb




# Run with verbose output
$ go test ./internal/filter -v
=== RUN   TestApply_SizeFilter
--- PASS: TestApply_SizeFilter (0.00s)
=== RUN   TestApply_DurationFilter
--- PASS: TestApply_DurationFilter (0.00s)
=== RUN   TestApply_PathContains
--- PASS: TestApply_PathContains (0.00s)
...

# Check coverage
$ go test ./... -coverprofile=coverage.out
$ go tool cover -html=coverage.out




# Run all integration tests
go test -v -run Integration

# Run specific integration test
go test -v -run TestIntegration_CompleteWatchWorkflow

# Run with race detector
go test -race -run Integration

# Run benchmarks
go test -bench=. -benchmem

# Generate coverage report
go test -coverprofile=coverage.out
go tool cover -html=coverage.out

# Run only unit tests (exclude integration)
go test ./internal/... -v

# Run everything with verbose output
go test -v ./...




# .github/workflows/test.yml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-go@v4
        with:
          go-version: '1.21'
      - run: go test ./... -race -coverprofile=coverage.out
      - run: go tool cover -func=coverage.out


sqlc generate
sqlc vet
sqlc diff

library/lb.py
library/readme.py

library/createdb/fs_add.py
library/createdb/fs_add_metadata.py

library/createdb/av.py

library/mediadb/db_media.py
library/mediadb/optimize_db.py
library/utils/db_utils.py

library/folders/big_dirs.py
library/folders/filter_src.py
library/fsdb/files_info.py
library/fsdb/disk_usage.py
library/mediadb/history_add.py
library/mediadb/db_history.py
library/mediadb/history.py
library/mediadb/stats.py
library/fsdb/search_db.py
library/mediadb/search.py
library/text/cluster_sort.py
library/text/regex_sort.py
library/tablefiles/columns.py
library/tablefiles/incremental_diff.py
library/text/timestamps.py
library/utils/arggroups.py
library/utils/consts.py
library/utils/devices.py
library/utils/iterables.py
library/utils/nums.py
library/utils/objects.py
library/utils/printing.py
library/utils/processes.py
library/utils/sqlgroups.py
library/utils/strings.py

library/utils/date_utils.py
library/utils/pd_utils.py
library/utils/arg_utils.py
library/utils/argparse_utils.py
library/utils/file_utils.py
library/utils/log_utils.py
library/utils/mpv_utils.py
library/utils/path_utils.py
library/utils/shell_utils.py
library/utils/sql_utils.py
